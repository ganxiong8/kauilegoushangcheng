!function(o){if(o.cookie("cookiesid")&&o.cookie("cookienum")){var n=o.cookie("cookiesid").split(","),e=o.cookie("cookienum").split(",");o.each(n,function(i,t){!function(e,s){o.ajax({url:"../php/index.php",dataType:"json"}).done(function(i){o.each(i,function(i,t){if(e==t.sid){var n=o(".item_list:hidden").clone(!0,!0);n.find(".box_img").find("img").attr("src",t.url),n.find(".box_img").find("img").attr("sid",t.sid),n.find(".box_titl").find("a").html(t.title),n.find(".s_price").find("p").html(t.price),n.find(".s_num").find("input").val(s),n.find(".s_sum").find("em").html((t.price*s).toFixed(2)),n.css("display","block"),o(".shop_list").append(n),c()}})})}(n[i],e[i])})}function c(){var n=0,e=0;o(".item_list:visible").each(function(i,t){o(t).find(".car_check input").prop("checked")&&(n+=parseInt(o(t).find(".s_num").find("input").val()),e+=parseFloat(o(t).find(".s_sum").find("em").html()))}),o(".sel_ok_num").find("em").html(n),o(".sel_type").find("em").html(e.toFixed(2))}o(".all_sel").on("change",function(){o(".item_list:visible").find(":checkbox").prop("checked",o(this).prop("checked")),o(".all_sel").prop("checked",o(this).prop("checked")),c()});var i=o(".item_list:visible").find(":checkbox");function t(i){return(parseFloat(i.parents(".item_list").find(".s_price").find("p").html())*parseInt(i.parents(".item_list").find(".s_num input").val())).toFixed(2)}o(".shop_list").on("change",i,function(){o(".item_list:visible").find("input:checkbox").length==o(".item_list:visible").find("input:checked").size()?o(".all_sel").prop("checked",!0):o(".all_sel").prop("checked",!1),c()}),o(".add").on("click",function(){var i=o(this).parents(".item_list").find(".s_num input").val();99<=++i&&(i=99),o(this).parents(".item_list").find(".s_num input").val(i),o(this).parents(".item_list").find(".s_sum").find("em").html(t(o(this))),c(),p(o(this))}),o(".redu").on("click",function(){var i=o(this).parents(".item_list").find(".s_num input").val();--i<=1&&(i=1),o(this).parents(".item_list").find(".s_num input").val(i),o(this).parents(".item_list").find(".s_sum").find("em").html(t(o(this))),c(),p(o(this))}),o(".s_num input").on("input",function(){var i=parseInt(o(this).val());/^\d+$/g.test(i)?99<=i?o(this).val(99):i<=0?o(this).val(1):o(this).val(i):o(this).val(1),o(this).parents(".item_list").find(".s_sum").find("em").html(t(o(this))),c(),p(o(this))});var s=[],l=[];function d(){o.cookie("cookiesid")&&o.cookie("cookienum")&&(s=o.cookie("cookiesid").split(","),l=o.cookie("cookienum").split(","))}function p(i){d();var t=i.parents(".item_list").find("img").attr("sid");l[o.inArray(t,s)]=i.parents(".item_list").find(".s_num input").val(),o.cookie("cookienum",l.toString(),{expires:7})}o(".shop_list").on("click",".s_del a",function(i){d(),confirm("你确定要删除吗？")&&o(this).first().parents(".item_list").remove(),function(n,i){var e=-1;o.each(i,function(i,t){n==t&&(e=i)}),i.splice(e,1),l.splice(e,1),o.cookie("cookiesid",i.toString(),{expires:7}),o.cookie("cookienum",l.toString(),{expires:7})}(o(this).first().parents(".item_list").find("img").attr("sid"),s),c()})}(jQuery);